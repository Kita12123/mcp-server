# Git連携機能 設計書

このドキュメントは、MCPサーバーに実装するGit連携機能の設計を定義するものです。

## 1. 目的

Clineを通じて、自然言語で基本的なGit操作（状態確認、コミット、リモート同期）を可能にすることを目的とします。これにより、開発ワークフローの一部を自動化・効率化します。

## 2. 提供ツール一覧

ユーザーに提供するツール（機能）は以下の通りです。

-   **`git_status`**:
    -   **説明**: ワークツリーの変更状態（未追跡、変更、ステージング済み）を取得します。
    -   **パラメータ**: なし

-   **`git_add`**:
    -   **説明**: 指定されたファイルをステージングエリアに追加します。
    -   **パラメータ**:
        -   `files` (string[], 必須): ステージングするファイルパスの配列。`["."]`を指定すると、変更されたすべてのファイルを対象とします。

-   **`git_commit`**:
    -   **説明**: ステージングされた変更をコミットします。
    -   **パラメータ**:
        -   `message` (string, 必須): コミットメッセージ。

-   **`git_pull`**:
    -   **説明**: リモートリポジトリの最新の変更を取得し、ローカルブランチにマージします。
    -   **パラメータ**:
        -   `remote` (string, オプション, default: 'origin'): リモート名。
        -   `branch` (string, オプション): プルするブランチ名。指定しない場合は現在のブランチに設定された上流ブランチからプルします。

-   **`git_push`**:
    -   **説明**: ローカルのコミットをリモートリポジトリにプッシュします。
    -   **パラメータ**:
        -   `remote` (string, オプション, default: 'origin'): リモート名。
        -   `branch` (string, オプション): プッシュするブランチ名。指定しない場合は現在のブランチをプッシュします。

## 3. 実装方針

-   **Gitクライアント (`src/lib/git.ts`)**:
    -   Node.jsの`child_process`モジュールを利用して、サーバー環境で`git`コマンドを実行する`GitClient`クラスを作成します。
    -   コマンド実行の標準出力・標準エラーをハンドリングし、結果を整形して返すメソッド（`status`, `add`, `commit`, `pull`, `push`）を実装します。
-   **ツール定義 (`src/tools/git.ts`)**:
    -   Clineに公開する上記5つのツール定義を記述します。
    -   ツールの`execute`関数内で`GitClient`の対応するメソッドを呼び出します。

## 4. 認証

-   このツールは、サーバーを実行しているユーザーのローカルGit設定（例: `~/.gitconfig`）に依存します。
-   `git pull`や`git push`でリモートリポジトリへの認証が必要な場合は、サーバー環境側でSSHキー認証やGit Credential Managerなどを事前に設定しておく必要があります。ツール自体が動的に認証情報を扱う機能は持ちません。
